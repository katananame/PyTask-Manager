# PyTask Manager

Веб-приложение для управления задачами, построенное на Django с использованием MongoDB в качестве базы данных. Приложение предоставляет функционал создания, редактирования, удаления и организации задач в формате Kanban-доски.

## Описание проекта

PyTask Manager - это полнофункциональное приложение для управления задачами с поддержкой:
- Регистрации и аутентификации пользователей
- Создания, редактирования и удаления задач
- Организации задач в Kanban-доску (Сделать, В работе, Готово)
- Фильтрации задач по статусу и приоритету
- Поиска задач с автозаполнением
- Цветового кодирования приоритетов
- Адаптивного дизайна для мобильных устройств

## Стек технологий

### Backend
- **Python 3.13+** - основной язык программирования
- **Django 5.2.8** - веб-фреймворк
- **MongoDB** - NoSQL база данных
- **MongoEngine 0.29.1** - ODM (Object Document Mapper) для работы с MongoDB
- **PyMongo 3.11.4** - драйвер для MongoDB

### Frontend
- **HTML5** - разметка
- **CSS3** - стилизация
- **JavaScript** - интерактивность (автозаполнение, фильтрация)

### Инструменты разработки
- **SQLite** - для Django ORM (админка, сессии, аутентификация)
- **setuptools** - управление пакетами

## Требования

- Python 3.13 или выше
- MongoDB 8.2 или выше
- pip (менеджер пакетов Python)
- Git (для клонирования репозитория)

## Установка и запуск

### 1. Клонирование репозитория

```bash
git clone <repository-url>
cd PyTask-Manager
```

### 2. Создание виртуального окружения

**Windows:**
```bash
python -m venv venv
venv\Scripts\activate
```

**Linux/Mac:**
```bash
python3 -m venv venv
source venv/bin/activate
```

### 3. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 4. Настройка MongoDB

Убедитесь, что MongoDB установлен и запущен:

**Windows:**
- MongoDB должен быть установлен как служба Windows
- Проверьте, что служба MongoDB запущена в "Службы" (services.msc)

**Linux:**
```bash
sudo systemctl start mongod
sudo systemctl status mongod
```

**Mac:**
```bash
brew services start mongodb-community
```

MongoDB должен быть доступен на `localhost:27017` (по умолчанию).

### 5. Настройка проекта

Настройки подключения к MongoDB находятся в `taskmanager/settings.py`:

```python
mongoengine.connect(
    db='taskmanager_db',
    host='localhost',
    port=27017,
)
```

При необходимости измените параметры подключения (хост, порт, имя базы данных).

### 6. Выполнение миграций

```bash
python manage.py migrate
```

Эта команда создаст необходимые таблицы в SQLite для Django ORM (админка, сессии, аутентификация).

### 7. Создание суперпользователя (опционально)

Для доступа к административной панели Django:

```bash
python manage.py createsuperuser
```

### 8. Запуск сервера разработки

```bash
python manage.py runserver
```

Сервер будет доступен по адресу: `http://localhost:8000`

### 9. Доступ к приложению

- Главная страница: `http://localhost:8000`
- Административная панель: `http://localhost:8000/admin`

## Тестирование

Проект включает набор unit-тестов для проверки корректности работы моделей, представлений и безопасности.

### Структура тестов

Тесты организованы в папке `tasks/tests/`:

- `test_models.py` - тесты моделей данных
- `test_views.py` - тесты представлений (views)
- `test_security.py` - тесты безопасности и прав доступа

### Запуск тестов

**Все тесты:**
```bash
python manage.py test tasks.tests
```

**Конкретный файл тестов:**
```bash
python manage.py test tasks.tests.test_models
python manage.py test tasks.tests.test_views
python manage.py test tasks.tests.test_security
```

**Конкретный тест:**
```bash
python manage.py test tasks.tests.test_security.SecurityTest.test_user_cannot_edit_others_task
```

**С подробным выводом:**
```bash
python manage.py test tasks.tests --verbosity=2
```

### Описание тестов

#### test_models.py
Проверяет корректность работы модели Task:
- Создание задачи со всеми полями
- Свойство user для получения объекта пользователя
- Автоматическое обновление поля updated_at при сохранении
- Синхронизация статуса и поля completed
- Значения по умолчанию для полей

#### test_views.py
Проверяет корректность работы представлений:
- Требование авторизации для доступа к страницам
- Отображение только задач текущего пользователя
- Создание новой задачи
- Редактирование существующей задачи
- Удаление задачи
- Проверка прав доступа при редактировании и удалении

#### test_security.py
Проверяет безопасность и изоляцию данных:
- Пользователь видит только свои задачи
- Пользователь не может редактировать чужие задачи
- Пользователь не может удалять чужие задачи
- Пользователь не может изменять статус чужих задач
- Правильная привязка задачи к пользователю при создании
- Редирект неавторизованных пользователей на страницу входа

### Результаты тестирования

Все тесты должны проходить успешно. При запуске вы увидите:

```
Ran 19 tests in XX.XXXs

OK
```

## Структура проекта

```
PyTask-Manager/
├── manage.py                 # Точка входа Django
├── requirements.txt          # Зависимости проекта
├── README.md                 # Документация
├── db.sqlite3                # База данных SQLite (Django ORM)
│
├── taskmanager/              # Основной модуль проекта
│   ├── __init__.py
│   ├── settings.py           # Настройки проекта
│   ├── urls.py               # Главный файл маршрутизации
│   ├── wsgi.py               # WSGI конфигурация
│   └── asgi.py               # ASGI конфигурация
│
└── tasks/                    # Приложение задач
    ├── __init__.py
    ├── models.py             # Модель Task (MongoDB)
    ├── views.py               # Представления (views)
    ├── urls.py                # Маршрутизация приложения
    ├── forms.py               # Формы Django
    ├── admin.py               # Админ-панель
    ├── apps.py                # Конфигурация приложения
    ├── decorators.py          # Декораторы для проверки прав
    ├── middleware.py          # Middleware для безопасности
    │
    ├── templates/             # HTML шаблоны
    │   └── tasks/
    │       ├── base.html
    │       ├── login.html
    │       ├── register.html
    │       ├── task_list.html
    │       ├── task_form.html
    │       └── task_confirm_delete.html
    │
    └── tests/                 # Unit-тесты
        ├── __init__.py
        ├── test_models.py
        ├── test_views.py
        └── test_security.py
```

## Основные функции

### Аутентификация
- Регистрация новых пользователей
- Вход в систему
- Выход из системы
- Защита страниц, требующих авторизации

### Управление задачами
- Создание задачи с полями:
  - Название (обязательное)
  - Описание
  - Статус (Сделать, В работе, Готово)
  - Приоритет (Низкий, Средний, Высокий)
  - Срок выполнения
- Редактирование задачи
- Удаление задачи
- Переключение статуса задачи

### Kanban-доска
- Три колонки: Сделать, В работе, Готово
- Цветовое кодирование приоритетов:
  - Низкий - желтый
  - Средний - оранжевый
  - Высокий - красный
- Карточки задач с полной информацией

### Поиск и фильтрация
- Поиск задач по названию
- Автозаполнение при вводе
- Фильтрация по статусу
- Фильтрация по приоритету
- Комбинирование поиска и фильтров

### Безопасность
- Защита от SQL-инъекций
- Защита от XSS-атак
- CSRF-защита
- Проверка прав доступа к задачам
- Изоляция данных между пользователями

## Настройки безопасности

В файле `taskmanager/settings.py` настроены следующие параметры безопасности:

- SECURE_BROWSER_XSS_FILTER = True
- SECURE_CONTENT_TYPE_NOSNIFF = True
- X_FRAME_OPTIONS = 'DENY'
- CSRF_COOKIE_HTTPONLY = True
- SESSION_COOKIE_HTTPONLY = True
- SESSION_COOKIE_SAMESITE = 'Strict'
- CSRF_COOKIE_SAMESITE = 'Strict'

## База данных

Проект использует гибридный подход к базам данных:

- **MongoDB** - для хранения задач (через MongoEngine)
- **SQLite** - для Django ORM (админка, сессии, аутентификация)

При первом обращении к модели Task автоматически создается коллекция `tasks` в базе данных `taskmanager_db`.

## Разработка

### Добавление новых функций

1. Создайте миграции для изменений в моделях (если используете Django ORM)
2. Обновите views в `tasks/views.py`
3. Добавьте маршруты в `tasks/urls.py`
4. Создайте или обновите шаблоны в `tasks/templates/tasks/`
5. Напишите тесты в `tasks/tests/`
6. Запустите тесты для проверки

### Отладка

Для включения режима отладки установите в `taskmanager/settings.py`:

```python
DEBUG = True
```

В production установите `DEBUG = False` и настройте `ALLOWED_HOSTS`.

## Лицензия

Проект создан в образовательных целях.

## Контакты

Для вопросов и предложений создайте issue в репозитории проекта.
